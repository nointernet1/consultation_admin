<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ chat.title }} - Telegram Client</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script>
        // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            scrollToBottom();
            startAutoRefresh();
        };
        
        function scrollToBottom() {
            const container = document.querySelector('.messages-container');
            container.scrollTop = container.scrollHeight;
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        function startAutoRefresh() {
            setInterval(function() {
                fetch(/chat/{{ chat.id }})
                    .then(response => response.text())
                    .then(html => {
                        const parser = new DOMParser();
                        const newDoc = parser.parseFromString(html, 'text/html');
                        const newMessages = newDoc.querySelector('.messages-container').innerHTML;
                        document.querySelector('.messages-container').innerHTML = newMessages;
                        scrollToBottom();
                    });
            }, 10000); // 10 —Å–µ–∫—É–Ω–¥
        }
    </script>
</head>
<body class="dark-theme">
    <div class="container">
        <div class="main">
            <header class="chat-header">
                <a href="/chats" class="btn back">‚¨ÖÔ∏è</a>
                <h2>{{ chat.title }}</h2>
                <a href="/chat/{{ chat.id }}" class="btn refresh">üîÑ</a>
            </header>
            
            <div class="messages-container">
                {% for message in messages %}
                <div class="message {% if message.direction == 'incoming' %}incoming{% else %}outgoing{% endif %}">
                    <div class="message-content">
                        {{ message.text }}
                        <span class="time">{{ message.timestamp.strftime('%H:%M') }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <form class="message-input" action="/chat/{{ chat.id }}" method="POST" onsubmit="scrollToBottom()">
                <input type="text" name="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autofocus required>
                <button type="submit" class="btn send">‚û°Ô∏è</button>
            </form>
        </div>
    </div>
</body>
</html>